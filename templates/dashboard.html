<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Task Dashboard</title>
    <link href="/static/bootstrap.min.css" rel="stylesheet">
    <script src="/static/bootstrap.bundle.min.js"></script>
    <script src="/static/script.js"></script>
</head>

<body>
    <div class="container py-5">
        <h2>Hello, {{user.email}}!</h2>
        <a href="/logout" class="btn btn-danger float-end">Logout</a>
        <h3 class="mt-4">Tasks Created</h3>
        <table class="table table-hover table-bordered">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Deadline</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Assigned To</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks_created %}

                <tr {% if task.status=="Completed" %} class="table-success" <!-- green for completed -->
                    {% elif task.status == "Pending" %}
                    class="table-danger" <!-- red for pending -->
                    {% endif %}



                    <td>{{task.title}}</td>
                    <td>{{task.description}}</td>
                    <td>{{task.deadline}}</td>
                    <td>{{task.priority}}</td>
                    <td>
                        <form action="/update-task/{{task.id}}" method="post" style="display:inline-block;">
                            <select name=task_status data-task-id="{{ task.id }}" onchange="this.form.submit()">
                                <option value="Pending" {% if task.status=="Pending" %}selected{% endif %}>Pending
                                </option>
                                <option value="Completed" {% if task.status=="Completed" %}selected{% endif %}>Completed
                                </option>
                            </select>
                        </form>
                    </td>
                    <td>{{task.assigned_to}}</td>
                    <td>
                        <form action="/delete-task/{{ task.id }}" method="post" style="display:inline-block"
                            onsubmit="return confirm('Are you sure you want to delete this task?');">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <h3 class="mt-4">Assign New Task</h3>
        <form id="addTaskForm" action="/add-task" method="post" class="row g-3">
            <div class="col-md-6"><input class="form-control" name="title" required placeholder="Title"></div>
            <div class="col-md-6"><input class="form-control" name="description" required placeholder="Description">
            </div>
            <div class="col-md-4"><input class="form-control" name="deadline" required type="datetime-local"
                    placeholder="Deadline"></div>
            <div class="col-md-4">
                <select name="priority" class="form-select">
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                </select>
            </div>
            <div class="col-md-4">
                <select name="assigned_to" class="form-select">
                    <!-- Optionally populate with db user list -->
                    <option value="{{user.id}}">Me</option>
                </select>
            </div>
            <div class="col-12"><button class="btn btn-success">Add Task</button></div>
        </form>
        <h3 class="mt-4">My Analytics</h3>
        <div class="alert alert-primary">Completed: {{stats.completed}} | Pending: {{stats.pending}} | Total:
            {{stats.total}}</div>
        <a href="/export" class="btn btn-info">Export CSV</a>
    </div>
</body>

</html>